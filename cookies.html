<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cookie Bakery — Cookies Premium</title>

<style>
  :root{
    --accent:#C4553B;
    --text:#111;
    --muted:#767676;
    --bg:#faf9f7;
    --card:#ffffff;
    --radius:16px;
    font-family: "Inter", Arial, sans-serif;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);color:var(--text);}
  header{
    width:100%;padding:18px 0;background:#fff;
    border-bottom:1px solid #eee;
    position:sticky;top:0;z-index:200;
  }
  .container{max-width:1160px;margin:auto;padding:0 18px;}
  .nav{display:flex;align-items:center;justify-content:space-between;}
  .brand{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:700;}
  .brand span{color:var(--accent);}
  .nav a{text-decoration:none;color:var(--muted);font-weight:500;margin-left:18px;}
  .btn-cart{
    background:var(--accent);color:#fff;border:0;border-radius:8px;
    padding:10px 18px;font-weight:600;cursor:pointer;
  }

  /* PRODUCT GRID */
  .section-title{margin:34px 0 14px;font-size:26px;font-weight:700;text-align:center;}
  .products{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
    gap:22px;margin-bottom:60px;
  }
  .product{
    background:var(--card);border-radius:var(--radius);
    overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);
    display:flex;flex-direction:column;transition:.25s;
  }
  .product:hover{transform:translateY(-4px);}
  .product img{width:100%;height:240px;object-fit:cover;}
  .details{padding:14px;flex:1;display:flex;flex-direction:column;}
  .title{font-size:16px;font-weight:600;margin-bottom:6px;}
  .price{font-size:16px;font-weight:700;color:var(--accent);margin-top:auto;}
  .add-btn{
    margin-top:10px;background:#111;color:#fff;border:0;
    padding:8px;border-radius:8px;font-weight:600;cursor:pointer;
  }

  /* CART */
  .cart-drawer{
    position:fixed;top:0;right:0;width:420px;max-width:100%;
    height:100vh;background:#fff;z-index:3000;padding:20px;
    transform:translateX(110%);transition:.3s;
    overflow:auto;
  }
  .cart-drawer.open{transform:translateX(0);}
  .cart-item{display:flex;gap:10px;margin-bottom:12px;}
  .cart-item img{width:60px;border-radius:8px;}
  .checkout-input{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ddd;}
  .checkout-btn{margin-top:18px;width:100%;padding:12px;border:0;background:var(--accent);color:#fff;font-weight:700;border-radius:10px;}
</style>
</head>

<body>

<header>
  <div class="container nav">
    <div class="brand"><span>Cookie</span>Bakery</div>
    <nav>
      <a href="#">Home</a>
      <a href="#" style="color:var(--accent)">Cookies</a>
    </nav>
    <button id="cartBtn" class="btn-cart">Keranjang (0)</button>
  </div>
</header>

<div class="container">
  <h2 class="section-title">Cookies Premium</h2>
  <div class="products" id="productsGrid"></div>
</div>

<!-- CART DRAWER -->
<div id="cartDrawer" class="cart-drawer">
  <h3>Keranjang</h3>
  <div id="cartItems"></div>

  <h4 style="margin-top:14px">Checkout</h4>
  <input id="custName" class="checkout-input" placeholder="Nama lengkap">
  <input id="custPhone" class="checkout-input" placeholder="Nomor telepon">
  <input id="custAddr" class="checkout-input" placeholder="Alamat lengkap">
  <textarea id="custNote" class="checkout-input" placeholder="Catatan (Opsional)"></textarea>
  <button id="checkoutBtn" class="checkout-btn">Checkout & Kirim WhatsApp</button>
  <button id="closeCart" class="checkout-btn" style="background:#777;margin-top:10px;">Tutup</button>
</div>

<!-- Firebase & PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script type="module">
/* Firebase */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, push, ref, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBk57WWCAV9PbUQBb_bj7mPtl09oNz7WnA",
  authDomain: "schesakra.firebaseapp.com",
  databaseURL: "https://schesakra-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "schesakra",
  storageBucket: "schesakra.appspot.com",
  messagingSenderId: "672537227977",
  appId: "1:672537227977:web:88b24f905c86eba7c05318"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

/* Products */
const products = [
  {id:1,title:"Choco Pastry Stick Box",price:35000,img:"https://via.placeholder.com/600x800?text=Choco+Pastry"},
  {id:2,title:"Cheese Pastry Stick Box",price:35000,img:"https://via.placeholder.com/600x800?text=Cheese+Pastry"},
];

const productsGrid=document.getElementById("productsGrid");

function renderProducts(){
  productsGrid.innerHTML = products.map(p=>`
    <div class="product">
      <img src="${p.img}">
      <div class="details">
        <div class="title">${p.title}</div>
        <div class="price">Rp ${p.price.toLocaleString()}</div>
        <button class="add-btn" data-id="${p.id}">Tambah</button>
      </div>
    </div>
  `).join("");

  document.querySelectorAll(".add-btn").forEach(btn=>{
    btn.onclick=()=>addToCart(products.find(x=>x.id==btn.dataset.id));
  });
}
renderProducts();

/* Cart Logic */
function getCart(){return JSON.parse(localStorage.getItem("cart")||"[]");}
function saveCart(c){localStorage.setItem("cart",JSON.stringify(c));}

function addToCart(p){
  const c=getCart();const f=c.find(x=>x.id===p.id);
  f?f.qty++:c.push({...p,qty:1});saveCart(c);updateCartUI();
}

function updateCartUI(){
  const c = getCart();
  
  // ✅ KEMBALIKAN PERHITUNGAN JUMLAH ITEM DI BADGE
  document.getElementById("cartBtn").textContent = `Keranjang (${c.reduce((s,i)=>s+i.qty,0)})`;

  document.getElementById("cartItems").innerHTML =
    c.length > 0
      ? c.map(i => `
          <div class="cart-item">
            <img src="${i.img}">
            <div style="flex:1;">
              ${i.title}<br>
              <small>${i.qty} x Rp ${i.price.toLocaleString()}</small><br>
              <b>Rp ${(i.qty * i.price).toLocaleString()}</b>
            </div>
          </div>
        `).join("")
      : "Keranjang kosong";
}

updateCartUI();

document.getElementById("cartBtn").onclick=()=>document.getElementById("cartDrawer").classList.add("open");
document.getElementById("closeCart").onclick=()=>document.getElementById("cartDrawer").classList.remove("open");

/* Checkout WhatsApp + PDF */
document.getElementById("checkoutBtn").onclick=async()=>{
  const cart=getCart();const name=custName.value;const phone=custPhone.value;const addr=custAddr.value;const note=custNote.value;
  const now=new Date();const inv=`INV-${now.getTime()}`;
  const total=cart.reduce((s,i)=>s+i.qty*i.price,0);

// Format sesuai admin dashboard
const order = {
  invoiceNo: inv,
  createdAt: now.toISOString(),
  customer: {
    name: name,
    phone: phone,
    address: addr,
    note: note || "-"
  },
  items: cart.map(i => ({
    id: i.id,
    title: i.title,
    price: i.price,
    qty: i.qty,
    lineTotal: i.qty * i.price
  })),
  subtotal: total,
  shipping: 0,
  total: total,
  status: "pending"
};

await set(push(ref(db,"orders")), order);

  const message=`Halo, saya ingin pesan.%0AInvoice: ${inv}%0A${cart.map(i=>`${i.qty} x ${i.title}`).join(", ")}%0ATotal: Rp ${total.toLocaleString()}%0AAlamat: ${encodeURIComponent(addr)}`;
  window.open(`https://wa.me/62816772145?text=${message}`,"_blank");

  localStorage.removeItem("cart");updateCartUI();
  document.getElementById("cartDrawer").classList.remove("open");
};
</script>

</body>
</html>
