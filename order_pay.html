<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Konfirmasi Pembayaran</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    .box { border:1px solid #ddd; padding:20px; border-radius:10px; }
  </style>
</head>
<body>

<h2>Konfirmasi Pembayaran</h2>

<div class="box">
  <p><b>Silakan transfer ke rekening berikut:</b></p>
  <p><b>Bank:</b> BCA</p>
  <p><b>No Rekening:</b> 1234567890</p>
  <p><b>Atas Nama:</b> UPTD Puskesmas Padasuka</p>
</div>

<br>

<div class="box">
  <h3>Upload Bukti Transfer:</h3>
  <input type="file" id="proofFile"><br><br>
  <button id="uploadBtn">Upload Bukti</button>
</div>

<script>
  // Init Firebase
  const firebaseConfig = YOUR_FIREBASE_CONFIG;
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const orderId = new URLSearchParams(window.location.search).get("id");

  document.getElementById("uploadBtn").onclick = async () => {
    const file = document.getElementById("proofFile").files[0];
    if (!file) return alert("Pilih gambar dulu");

    const ref = storage.ref(`payment_proofs/${orderId}.jpg`);
    await ref.put(file);
    const url = await ref.getDownloadURL();

    await db.collection("orders").doc(orderId).update({
      paymentProofUrl: url,
      status: "waiting_verification"
    });

    alert("Bukti pembayaran berhasil diupload! Menunggu konfirmasi admin.");
    window.location = "order_success.html";
  }
</script>

</body>
</html>
