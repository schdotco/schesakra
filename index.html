<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard - Welcome</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { 
  font-family: Arial, sans-serif; 
  background: #f4f6f8; 
  margin: 0; 
  padding: 0; 
  color: #1f2937;
}

header {
  background: #3b82f6;
  color: white;
  padding: 24px 16px;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

header h1 { margin: 0; font-size: 1.8rem; }
header p { margin: 4px 0 0; font-size: 1rem; }

.container { max-width: 1100px; margin: auto; padding: 20px; }

h2 { margin-bottom: 16px; font-size: 1.5rem; }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  transition: transform 0.2s, box-shadow 0.2s;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  text-align: center;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.card img {
  width: 100%;
  max-width: 150px;
  height: 150px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 12px;
  background: #e5e7eb;
}

.card h3 { margin: 0 0 8px; font-size: 1.1rem; color: #1f2937; }
.card p { margin: 4px 0; color: #555; font-size: 0.95rem; }
.card .price { font-weight: bold; color: #3b82f6; margin-top: 8px; }
.card button {
  margin-top: 12px;
  padding: 10px;
  background: #10b981;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95rem;
  transition: 0.2s;
  width: 100%;
}
.card button:hover { background: #059669; }

@media (max-width: 480px) {
  header h1 { font-size: 1.4rem; }
  header p { font-size: 0.9rem; }
  h2 { font-size: 1.3rem; }
  .card { padding: 12px; }
  .card button { font-size: 0.9rem; }
  .card img { max-width: 120px; height: 120px; }
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

// Konfigurasi Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBk57WWCAV9PbUQBb_bj7mPtl09oNz7WnA",
  authDomain: "schesakra.firebaseapp.com",
  projectId: "schesakra",
  storageBucket: "schesakra.firebasestorage.app",
  messagingSenderId: "672537227977",
  appId: "1:672537227977:web:88b24f905c86eba7c05318"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const productGrid = document.getElementById("productGrid");

// Fungsi untuk konversi Google Drive link menjadi direct link
function convertDriveLink(url) {
  try {
    if (!url) return url;
    const regex = /https:\/\/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)\/view/;
    const match = url.match(regex);
    if (match && match[1]) {
      return `https://drive.google.com/uc?export=view&id=${match[1]}`;
    }
    return url; // Jika bukan Google Drive, tetap pakai url asli
  } catch {
    return url;
  }
}

// Fungsi untuk load produk otomatis
async function loadProducts() {
  try {
    const snapshot = await getDocs(collection(db, "stok"));
    productGrid.innerHTML = "";

    if(snapshot.empty){
      productGrid.innerHTML = "<p>Tidak ada produk saat ini.</p>";
      return;
    }

    snapshot.docs.forEach(docSnap => {
      const data = docSnap.data();
      const card = document.createElement("div");
      card.classList.add("card");

      // Default image jika tidak ada imageUrl
      let imageUrl = data.imageUrl || "https://via.placeholder.com/150x150?text=No+Image";

      // Jika link dari Google Drive, convert menjadi direct link
      imageUrl = convertDriveLink(imageUrl);

      card.innerHTML = `
        <img src="${imageUrl}" alt="${data.name}">
        <h3>${data.name}</h3>
        <p>Deskripsi: ${data.description || "-"}</p>
        <p class="price">Rp ${data.price ? data.price.toLocaleString() : "0"}</p>
        <button>Order Sekarang</button>
      `;

      // Tombol order menyimpan data ke localStorage
      const btn = card.querySelector("button");
      btn.onclick = () => {
        localStorage.setItem("selectedProduct", JSON.stringify({
          name: data.name,
          price: data.price || 0,
          description: data.description || "",
          imageUrl: imageUrl
        }));
        window.location.href = "order.html";
      };

      productGrid.appendChild(card);
    });

  } catch (error) {
    console.error("Error load produk:", error);
    productGrid.innerHTML = "<p>Gagal memuat produk. Silakan coba lagi.</p>";
  }
}

// Jalankan load produk saat halaman dibuka
loadProducts();
</script>

</head>
<body>

<header>
  <h1>Selamat Datang!</h1>
  <p>Anda telah mengakses situs ini. Silakan pilih produk untuk order.</p>
</header>

<div class="container">
  <h2>Produk Tersedia</h2>
  <div class="grid" id="productGrid">
    Memuat produk...
  </div>
</div>

</body>
</html>
