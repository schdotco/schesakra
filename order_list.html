<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Menu Admin - Daftar Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== BODY & LAYOUT ===== */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
  color: #1f2937;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 1.8rem;
}

/* ===== FILTER & BUTTONS ===== */
.filter-box {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.filter-box label {
  font-weight: 500;
}

.filter-box input[type="date"] {
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #cbd5e1;
  outline: none;
  font-size: 14px;
}

button.action-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.2s;
}

button.action-btn:hover {
  background: #2563eb;
}

button.rekap-btn {
  background: #10b981;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  margin: 0 auto 20px auto;
  display: block;
  transition: 0.2s;
}

button.rekap-btn:hover {
  background: #059669;
}

/* ===== TABLE ===== */
.table-box {
  background: white;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  min-width: 600px;
}

th, td {
  padding: 12px 10px;
  border-bottom: 1px solid #e2e8f0;
  text-align: left;
}

th {
  background: #f1f5f9;
  font-weight: 600;
  color: #334155;
}

.order-row:hover {
  background: #e0ebff;
  cursor: pointer;
  transition: 0.2s;
}

.status-unpaid {
  color: #dc2626;
  font-weight: bold;
}

.status-paid {
  color: #059669;
  font-weight: bold;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  table, th, td {
    font-size: 13px;
  }

  .filter-box {
    flex-direction: column;
    align-items: center;
  }

  button.action-btn {
    padding: 5px 10px;
    font-size: 13px;
  }

  button.rekap-btn {
    padding: 8px 14px;
    font-size: 15px;
  }
}

@media (max-width: 480px) {
  table, th, td {
    font-size: 12px;
  }

  .filter-box input[type="date"] {
    width: 100%;
  }

  button.action-btn {
    width: 100%;
    margin-bottom: 5px;
  }
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBk57WWCAV9PbUQBb_bj7mPtl09oNz7WnA",
  authDomain: "schesakra.firebaseapp.com",
  projectId: "schesakra",
  storageBucket: "schesakra.firebasestorage.app",
  messagingSenderId: "672537227977",
  appId: "1:672537227977:web:88b24f905c86eba7c05318"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ordersBody = document.getElementById("orders");
const startDateInput = document.getElementById("startDate");
const endDateInput = document.getElementById("endDate");

let allOrders = [];

// Real-time listener
onSnapshot(collection(db, "orders"), snapshot => {
  allOrders = [];
  snapshot.forEach(docSnap => {
    const d = docSnap.data();
    allOrders.push({ id: docSnap.id, ...d });
  });
  applyDateFilter();
});

// Fungsi render tabel
function renderOrders(orders) {
  ordersBody.innerHTML = "";
  if(orders.length === 0){
    ordersBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:#64748b;">Tidak ada order ditemukan</td></tr>`;
    return;
  }

  orders.forEach(d => {
    const tr = document.createElement("tr");
    tr.classList.add("order-row");

    tr.innerHTML = `
      <td>${d.name}</td>
      <td>${d.date}</td>
      <td>Rp ${d.grand.toLocaleString()}</td>
      <td class="status-${d.status}">${d.status.toUpperCase()}</td>
      <td>
        <button class="action-btn" onclick="confirmOrder('${d.id}')">Konfirmasi</button>
        <button class="action-btn" onclick="markPaid('${d.id}')">Sudah Bayar</button>
      </td>
    `;

    tr.onclick = (e) => {
      if (e.target.tagName !== "BUTTON") {
        localStorage.setItem("selectedOrderId", d.id);
        window.location.href = "order_pay.html";
      }
    };

    ordersBody.appendChild(tr);
  });
}

// Update status
window.confirmOrder = async (id) => {
  const docRef = doc(db, "orders", id);
  await updateDoc(docRef, { status: "confirmed" });
  alert("✅ Order dikonfirmasi!");
};

window.markPaid = async (id) => {
  const docRef = doc(db, "orders", id);
  await updateDoc(docRef, { status: "paid" });
  alert("✅ Status dibayar!");
};

// Rekap tombol
window.gotoRekap = () => {
  window.location.href = "rekaporder.html";
};

// Filter otomatis
window.applyDateFilter = () => {
  const start = startDateInput.value;
  const end = endDateInput.value;

  if (!start || !end) {
    renderOrders(allOrders);
    return;
  }

  const filtered = allOrders.filter(o => o.date >= start && o.date <= end);
  renderOrders(filtered);
};

startDateInput.addEventListener("change", applyDateFilter);
endDateInput.addEventListener("change", applyDateFilter);
</script>
</head>

<body>

<h2>Menu Admin - Daftar Order</h2>

<!-- Filter Tanggal -->
<div class="filter-box">
  <label>Dari: <input type="date" id="startDate"></label>
  <label>Sampai: <input type="date" id="endDate"></label>
</div>

<!-- Tombol Rekap -->
<button class="rekap-btn" onclick="gotoRekap()">Lihat Rekap Pesanan</button>

<!-- Tabel Order -->
<div class="table-box">
<table>
<thead>
<tr>
  <th>Nama</th>
  <th>Tanggal</th>
  <th>Total</th>
  <th>Status</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="orders"></tbody>
</table>
</div>

</body>
</html>
